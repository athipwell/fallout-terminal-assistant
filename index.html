<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Fallout Terminal Assistant Pro</title>
  <style>
    body { background: #050505; color: #0f0; font-family: 'Courier New', monospace; padding: 16px; max-width: 420px; margin: auto; text-transform: uppercase; }
    h1 { text-align: center; border-bottom: 2px solid #0f0; margin-bottom: 10px; font-size: 20px; }
    label { display: block; margin-top: 14px; font-size: 12px; color: #0a0; }
    
    /* Doubled the height of the word list box */
    textarea { 
      width: 100%; 
      font-family: 'Courier New', monospace; 
      font-size: 18px; 
      padding: 10px; 
      background: #000; 
      color: #0f0; 
      border: 1px solid #0f0; 
      box-sizing: border-box;
      height: 240px; /* Specific height for better control */
    }

    input, button { 
      width: 100%; 
      font-family: 'Courier New', monospace; 
      font-size: 18px; 
      padding: 10px; 
      background: #000; 
      color: #0f0; 
      border: 1px solid #0f0; 
      box-sizing: border-box; 
    }
    
    .mic-container { display: flex; align-items: center; justify-content: space-between; background: #010; padding: 10px; border: 1px inset #0f0; margin-top: 5px; }
    .voice-active { color: #f00; animation: blink 1s infinite; }
    @keyframes blink { 50% { opacity: 0; } }

    button { margin-top: 10px; cursor: pointer; background: #030; font-weight: bold; }
    button:hover { background: #050; }
    button:active { background: #0f0; color: #000; }
    
    .filter-btn { 
      background: #004400; 
      border: 2px solid #0f0; 
      padding: 15px; 
      margin-top: 20px; 
    }
    
    pre { margin-top: 12px; white-space: pre-wrap; font-size: 20px; color: #0ff; text-align: center; background: rgba(0, 255, 255, 0.05); padding: 10px; border: 1px dashed #0ff; min-height: 40px; }
    .log { font-size: 10px; color: #666; margin-top: 10px; border-top: 1px solid #222; max-height: 60px; overflow-y: auto; }
  </style>
</head>
<body>

  <h1>ROBCO TERMINAL PROTOCOL</h1>

  <label>1. LOAD WORD LIST</label>
  <textarea id="words" placeholder="ENTER ALL WORDS..."></textarea>
  
  <div class="mic-container">
    <span id="mic-status">MIC: OFF</span>
    <button onclick="toggleVoice()" id="mic-btn" style="width: auto; margin: 0; padding: 5px 15px;">START LISTENING</button>
  </div>

  <label>2. ENTER GUESS & LIKENESS</label>
  <div style="display: flex; gap: 5px;">
    <input id="guess" placeholder="WORD" style="flex: 2;">
    <input id="score" type="number" inputmode="numeric" placeholder="0" style="flex: 1;">
  </div>

  <button class="filter-btn" onclick="makeGuess()">EXECUTE FILTER</button>

  <h2>POSSIBILITIES</h2>
  <pre id="remaining">---</pre>

  <div class="log" id="history">SYSTEM READY...</div>

  <script>
    let candidates = [];
    let isListening = false;
    let recognition;

    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

    if (!SpeechRecognition) {
      document.getElementById('mic-status').textContent = "MIC: UNSUPPORTED";
      document.getElementById('mic-btn').disabled = true;
    } else {
      recognition = new SpeechRecognition();
      recognition.continuous = true;
      recognition.interimResults = false;

      recognition.onresult = (event) => {
        const transcript = event.results[event.results.length - 1][0].transcript;
        const cleanedWords = transcript.replace(/[^a-zA-Z\s]/g, ' ').split(/\s+/).filter(w => w.length > 2);
        const textArea = document.getElementById('words');
        textArea.value += (textArea.value ? '\n' : '') + cleanedWords.join('\n').toUpperCase();
      };

      recognition.onerror = (event) => {
        if (event.error === 'not-allowed') {
          alert("Error: Microphone access denied.");
        }
      };

      recognition.onend = () => {
        if (isListening) recognition.start(); 
      };
    }

    function toggleVoice() {
      if (!recognition) return;
      const btn = document.getElementById('mic-btn');
      const status = document.getElementById('mic-status');
      
      if (!isListening) {
        try {
          recognition.start();
          isListening = true;
          btn.textContent = "STOP LISTENING";
          status.textContent = "MIC: LISTENING...";
          status.classList.add('voice-active');
        } catch (e) { console.error(e); }
      } else {
        isListening = false;
        recognition.stop();
        btn.textContent = "START LISTENING";
        status.textContent = "MIC: OFF";
        status.classList.remove('voice-active');
      }
    }

    function getLikeness(str1, str2) {
      let score = 0;
      const len = Math.min(str1.length, str2.length);
      for (let i = 0; i < len; i++) {
        if (str1[i] === str2[i]) score++;
      }
      return score;
    }

    function makeGuess() {
      const wordInput = document.getElementById('words').value.trim();
      const guess = document.getElementById('guess').value.trim().toUpperCase();
      const scoreStr = document.getElementById('score').value;
      const score = parseInt(scoreStr);

      if (!wordInput) { alert("Please enter the word list first."); return; }
      if (!guess || scoreStr === "") { alert("Enter a guess and a score."); return; }

      if (candidates.length === 0) {
        candidates = wordInput.split(/\s+/).map(w => w.toUpperCase()).filter(w => w.length > 1);
      }

      candidates = candidates.filter(word => {
        if (word === guess) return false;
        return getLikeness(word, guess) === score;
      });

      document.getElementById('remaining').textContent = candidates.length > 0 ? candidates.join('\n') : "NO MATCHES";
      document.getElementById('history').innerHTML += `<br>[${guess} : ${score}] -> ${candidates.length} left`;
      
      document.getElementById('guess').value = "";
      document.getElementById('score').value = "";
    }
  </script>
</body>
</html>
