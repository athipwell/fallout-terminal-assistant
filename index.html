<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fallout Terminal Helper</title>

<script src="https://cdn.jsdelivr.net/npm/tesseract.js@5/dist/tesseract.min.js"></script>

<style>
body {
  background:black;
  color:#0f0;
  font-family:monospace;
  max-width:420px;
  margin:auto;
  padding:16px;
}

h1,h2 { text-align:center; }

button,input,textarea {
  width:100%;
  font-family:monospace;
  font-size:18px;
  background:black;
  color:#0f0;
  border:1px solid #0f0;
  padding:8px;
  margin-top:10px;
}

video {
  width:100%;
  border:1px solid #0f0;
  margin-top:10px;
}

.wordRow {
  display:flex;
  gap:6px;
  margin-top:6px;
}

.wordRow input {
  flex:1;
  color:cyan;
}

pre {
  text-align:center;
  color:cyan;
  font-size:18px;
}
</style>
</head>

<body>

<h1>Terminal Passcode Assistant</h1>

<button onclick="startCamera()">ðŸ“· Scan Column</button>
<video id="video" autoplay playsinline></video>
<button id="captureBtn" onclick="captureFrame()" style="display:none;">ðŸ“¸ Capture</button>
<canvas id="canvas" style="display:none;"></canvas>

<h2>Confirm Words</h2>
<div id="confirm"></div>
<button onclick="confirmWords()">âœ… Use These Words</button>

<label>Guessed Word</label>
<input id="guess">

<label>Number Correct</label>
<input id="score" inputmode="numeric">

<button onclick="makeGuess()">Filter Words</button>

<h2>Remaining</h2>
<pre id="remaining"></pre>

<script>
let stream = null;
let candidates = [];

function likeness(a,b){
  let s=0;
  for(let i=0;i<a.length;i++) if(a[i]===b[i]) s++;
  return s;
}

function makeGuess(){
  if(!candidates.length){
    candidates = document.getElementById('wordsFinal').value
      .split('\n').map(w=>w.trim()).filter(Boolean);
  }
  const g = guess.value.trim();
  const sc = parseInt(score.value);
  candidates = candidates.filter(w=>likeness(w,g)===sc);
  remaining.textContent = candidates.join('\n');
}

async function startCamera(){
  video.srcObject = await navigator.mediaDevices.getUserMedia({
    video:{facingMode:"environment"}
  });
  stream = video.srcObject;
  captureBtn.style.display="block";
}

async function captureFrame(){
  canvas.width = video.videoWidth * 2;
  canvas.height = video.videoHeight * 2;
  const ctx = canvas.getContext('2d');
  ctx.drawImage(video,0,0,canvas.width,canvas.height);

  stream.getTracks().forEach(t=>t.stop());
  captureBtn.style.display="none";

  const img = ctx.getImageData(0,0,canvas.width,canvas.height);
  const d = img.data;
  for(let i=0;i<d.length;i+=4){
    const g=(d[i]+d[i+1]+d[i+2])/3;
    const v=g>140?255:0;
    d[i]=d[i+1]=d[i+2]=v;
  }
  ctx.putImageData(img,0,0);

  const res = await Tesseract.recognize(canvas,'eng',{
    tessedit_char_whitelist:'ABCDEFGHIJKLMNOPQRSTUVWXYZ',
    tessedit_pageseg_mode:6
  });

  buildConfirmList(res.data.text);
}

function buildConfirmList(text){
  confirm.innerHTML="";
  const lines = text.split('\n')
    .map(l=>l.replace(/[^A-Z]/g,'').trim())
    .filter(l=>l.length>=3);

  lines.forEach(l=>{
    const row=document.createElement('div');
    row.className='wordRow';
    const inp=document.createElement('input');
    inp.value=l;
    row.appendChild(inp);
    confirm.appendChild(row);
  });
}

function confirmWords(){
  const words=[...document.querySelectorAll('#confirm input')]
    .map(i=>i.value.trim())
    .filter(w=>w.length>=4);

  // dominant length filter
  const counts={};
  words.forEach(w=>counts[w.length]=(counts[w.length]||0)+1);
  const len=Object.entries(counts).sort((a,b)=>b[1]-a[1])[0][0];

  const final=[...new Set(words.filter(w=>w.length==len))];

  let ta=document.getElementById('wordsFinal');
  if(!ta){
    ta=document.createElement('textarea');
    ta.id='wordsFinal';
    ta.style.display='none';
    document.body.appendChild(ta);
  }
  ta.value=final.join('\n');
  candidates=[];
  remaining.textContent="";
}
</script>

</body>
</html>
